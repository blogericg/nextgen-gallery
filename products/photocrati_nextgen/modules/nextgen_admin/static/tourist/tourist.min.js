(function(a){function t(t,e){for(var o in e)n.call(e,o)&&(t[o]=e[o]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t}var e,o,i,r,s,n={}.hasOwnProperty,p=function(t,e){return function(){return t.apply(e,arguments)}};function h(){return h.__super__.constructor.apply(this,arguments)}function u(t){this.options=null!=t?t:{},this.onClickNext=p(this.onClickNext,this),this.onClickClose=p(this.onClickClose,this),this.el=a("<div/>"),this.initialize(t),this._bindClickEvents(),Tourist.Tip.Base._cacheTip(this)}function l(){return l.__super__.constructor.apply(this,arguments)}function c(t){var e={offset:10,tipOffset:10};this.options=_.extend(e,t),this.el=a(a.parseHTML(this.template)),this.hide()}function f(){return this._renderTipBackground=p(this._renderTipBackground,this),f.__super__.constructor.apply(this,arguments)}function d(){return d.__super__.constructor.apply(this,arguments)}function y(t){var e,o;this.options=null!=t?t:{},this.onChangeCurrentStep=p(this.onChangeCurrentStep,this),this.next=p(this.next,this),e={tipClass:"Bootstrap"},this.options=_.extend(e,this.options),this.model=new Tourist.Model({current_step:null}),o=_.extend({model:this.model},this.options.tipOptions),this.view=new Tourist.Tip[this.options.tipClass](o),this.view.bind("click:close",_.bind(this.stop,this,!0)),this.view.bind("click:next",this.next),this.model.bind("change:current_step",this.onChangeCurrentStep)}window.Tourist=window.Tourist||{},Tourist.Model=(e=Backbone.Model,t(h,e),h.prototype._module="Tourist",h),window.Tourist.Tip=window.Tourist.Tip||{},Tourist.Tip.Base=(u.prototype._module="Tourist",_.extend(u.prototype,Backbone.Events),u.prototype.skipButtonTemplate='<button class="btn btn-default btn-sm pull-right tour-next">Skip this step →</button>',u.prototype.nextButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Next step →</button>',u.prototype.finalButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Finish up</button>',u.prototype.closeButtonTemplate='<a class="btn btn-close tour-close" href="#"><i class="icon icon-remove"></i></a>',u.prototype.okButtonTemplate='<button class="btn btn-sm tour-close btn-primary">Okay</button>',u.prototype.actionLabelTemplate=_.template('<h4 class="action-label"><%= label %></h4>'),u.prototype.actionLabels=["Do this:","Then this:","Next this:"],u.prototype.highlightClass="tour-highlight",u.prototype.template=_.template('<div>\n  <div class="tour-container">\n    <%= close_button %>\n    <%= content %>\n    <p class="tour-counter <%= counter_class %>"><%= counter%></p>\n  </div>\n  <div class="tour-buttons">\n    <%= buttons %>\n  </div>\n</div>'),u.prototype.destroy=function(){return this.el.remove()},u.prototype.render=function(t){return this.hide(),t&&(this._setTarget(t.target||!1,t),this._setZIndex(""),this._renderContent(t,this._buildContentElement(t)),t.target&&this.show(),t.zIndex&&this._setZIndex(t.zIndex,t)),this},u.prototype.show=function(){},u.prototype.hide=function(){},u.prototype.setTarget=function(t,e){return this._setTarget(t,e)},u.prototype.cleanupCurrentTarget=function(){return this.target&&this.target.removeClass&&this.target.removeClass(this.highlightClass),this.target=null},u.prototype.onClickClose=function(t){return this.trigger("click:close",this,t),!1},u.prototype.onClickNext=function(t){return this.trigger("click:next",this,t),!1},u.prototype._getTipElement=function(){},u.prototype._renderContent=function(t,e){},u.prototype._bindClickEvents=function(){var t=this._getTipElement();return t.on("click",".tour-close",this.onClickClose),t.on("click",".tour-next",this.onClickNext)},u.prototype._setTarget=function(t,e){return this.cleanupCurrentTarget(),t&&e&&e.highlightTarget&&t.addClass(this.highlightClass),this.target=t},u.prototype._setZIndex=function(t){return this._getTipElement().css("z-index",t||"")},u.prototype._buildContentElement=function(t){var e=this._buildButtons(t),o=a(a.parseHTML(this.template({content:t.content,buttons:e,close_button:this._buildCloseButton(t),counter:t.final?"":"step "+(t.index+1)+" of "+t.total,counter_class:t.final?"final":""})));return e||o.find(".tour-buttons").addClass("no-buttons"),this._renderActionLabels(o),o},u.prototype._buildButtons=function(t){var e="";return t.okButton&&(e+=this.okButtonTemplate),t.skipButton&&(e+=this.skipButtonTemplate),t.nextButton&&(e+=t.final?this.finalButtonTemplate:this.nextButtonTemplate),e},u.prototype._buildCloseButton=function(t){return t.closeButton?this.closeButtonTemplate:""},u.prototype._renderActionLabels=function(t){for(var e,o=t.find(".action"),i=0,s=[],n=0,r=o.length;n<r;n++)e=o[n],a(a.parseHTML(this.actionLabelTemplate({label:this.actionLabels[i]}))).insertBefore(e),s.push(i++);return s},u._cacheTip=function(t){return Tourist.Tip.Base._cachedTips||(Tourist.Tip.Base._cachedTips=[]),Tourist.Tip.Base._cachedTips.push(t)},u.destroy=function(){var t,e,o;if(Tourist.Tip.Base._cachedTips){for(t=0,e=(o=Tourist.Tip.Base._cachedTips).length;t<e;t++)o[t].destroy();return Tourist.Tip.Base._cachedTips=null}},u),Tourist.Tip.Bootstrap=(o=Tourist.Tip.Base,t(l,o),l.prototype.initialize=function(t){var e={showEffect:null,hideEffect:null};return this.options=_.extend(e,t),this.tip=new Tourist.Tip.BootstrapTip(this.options)},l.prototype.destroy=function(){return this.tip.destroy(),l.__super__.destroy.call(this)},l.prototype.show=function(){return this.options.showEffect?Tourist.Tip.Bootstrap.effects[this.options.showEffect].call(this,this.tip,this.tip.el):this.tip.show()},l.prototype.hide=function(){return this.options.hideEffect?Tourist.Tip.Bootstrap.effects[this.options.hideEffect].call(this,this.tip,this.tip.el):this.tip.hide()},l.prototype._getTipElement=function(){return this.tip.el},l.prototype._setTarget=function(t,e){return l.__super__._setTarget.call(this,t,e),this.tip.setTarget(t)},l.prototype._renderContent=function(t,e){var o=t.my||"left center",i=t.at||"right center";return this.tip.setContainer(t.container||a("body")),this.tip.setContent(e),this.tip.setPosition(t.target||!1,o,i)},l),Tourist.Tip.Bootstrap.effects={slidein:function(t,e){var o,i,s,n,r,p,h={top:80,left:80,right:-80,bottom:-80},u=t.my.split(" ")[0],l=h[u=u||"top"];for("bottom"===u&&(u="top"),"right"===u&&(u="left"),n=parseInt(e.css(u)),e.stop(),(o={})[u]=n+l,e.css(o),e.show(),o[u]=n,r=0,p=(s=["easeOutCubic","swing","linear"]).length;r<p&&(i=s[r],!a.easing[i]);r++);return e.animate(o,300,i),null}},Tourist.Tip.BootstrapTip=(c.prototype.template='<div class="popover tourist-popover">\n  <div class="arrow"></div>\n  <div class="popover-content"></div>\n</div>',c.prototype.FLIP_POSITION={bottom:"top",top:"bottom",left:"right",right:"left"},c.prototype.destroy=function(){return this.el.remove()},c.prototype.show=function(){return this.el.show().addClass("visible")},c.prototype.hide=function(){return this.el.hide().removeClass("visible")},c.prototype.setTarget=function(t){return this.target=t,this._setPosition(this.target,this.my,this.at)},c.prototype.setPosition=function(t,e,o){return this.target=t,this.my=e,this.at=o,this._setPosition(this.target,this.my,this.at)},c.prototype.setContainer=function(t){return t.append(this.el)},c.prototype.setContent=function(t){return this._getContentElement().html(t)},c.prototype._getContentElement=function(){return this.el.find(".popover-content")},c.prototype._getTipElement=function(){return this.el.find(".arrow")},c.prototype._setPosition=function(t,e,o){var i,s,n,r,p,h,u,l,a,c;if(null==e&&(e="left center"),null==o&&(o="right center"),t&&(i=(c=e.split(" "))[0],p=c[1],n=this.el.css("display"),this.el.css({top:0,left:0,margin:0,display:"block"}).removeClass("top").removeClass("bottom").removeClass("left").removeClass("right").addClass(this.FLIP_POSITION[i]),t))return u=this._getTipElement().css({left:"",right:"",top:"",bottom:""}),"center"!==p&&(l={left:u[0].offsetWidth/2,right:0,top:u[0].offsetHeight/2,bottom:0},(s={})[p]=l[p]+this.options.tipOffset,s[this.FLIP_POSITION[p]]="auto",u.css(s)),h=this._caculateTargetPosition(o,t),a=this._caculateTipPosition(e,h),r=this._adjustForArrow(e,a),this.el.css(r),this.el.css({display:n})},c.prototype._caculateTargetPosition=function(t,e){var o,i;return"[object Array]"===Object.prototype.toString.call(e)?{left:e[0],top:e[1]}:(o=this._getTargetBounds(e),i=this._lookupPosition(t,o.width,o.height),{left:o.left+i[0],top:o.top+i[1]})},c.prototype._caculateTipPosition=function(t,e){var o=this.el[0].offsetWidth,i=this.el[0].offsetHeight,s=this._lookupPosition(t,o,i);return{left:e.left-s[0],top:e.top-s[1]}},c.prototype._adjustForArrow=function(t,e){var o=t.split(" "),i=o[0],s=o[1],n=this._getTipElement(),r=n[0].offsetWidth,p=n[0].offsetHeight,h={top:e.top,left:e.left};switch(i){case"top":h.top+=p+this.options.offset;break;case"bottom":h.top-=p+this.options.offset;break;case"left":h.left+=r+this.options.offset;break;case"right":h.left-=r+this.options.offset}switch(s){case"left":h.left-=r/2+this.options.tipOffset;break;case"right":h.left+=r/2+this.options.tipOffset;break;case"top":h.top-=p/2+this.options.tipOffset;break;case"bottom":h.top+=p/2+this.options.tipOffset}return h},c.prototype._lookupPosition=function(t,e,o){var i=e/2,s=o/2;return{"top left":[0,0],"left top":[0,0],"top right":[e,0],"right top":[e,0],"bottom left":[0,o],"left bottom":[0,o],"bottom right":[e,o],"right bottom":[e,o],"top center":[i,0],"left center":[0,s],"right center":[e,s],"bottom center":[i,o]}[t]},c.prototype._getTargetBounds=function(t){var e=t[0],o="function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight};return a.extend({},o,t.offset())},c),Tourist.Tip.QTip=(i=Tourist.Tip.Base,t(f,i),r={top:80,left:80,right:-80,bottom:-80},f.prototype.QTIP_DEFAULTS={content:{text:" "},show:{ready:!1,delay:0,effect:function(t){var e,o,i,s=a(this),n=t.options.position.my;return n=n&&n[n.precedance],o=r[n=n||"top"],"bottom"===n&&(n="top"),"right"===n&&(n="left"),i=parseInt(s.css(n)),(e={})[n]=i+o,s.css(e),s.show(),e[n]=i,s.animate(e,300,"easeOutCubic"),null},autofocus:!1},hide:{event:null,delay:0,effect:!1},position:{adjust:{method:"shift shift",scroll:!1}},style:{classes:"ui-tour-tip",tip:{height:6,width:14}},events:{},zindex:2e3},f.prototype.initialize=function(t){return t=a.extend(!0,{},this.QTIP_DEFAULTS,t),this.el.qtip(t),this.qtip=this.el.qtip("api"),this.qtip.render()},f.prototype.destroy=function(){return this.qtip&&this.qtip.destroy(),f.__super__.destroy.call(this)},f.prototype.show=function(){return this.qtip.show()},f.prototype.hide=function(){return this.qtip.hide()},f.prototype._getTipElement=function(){return a("#qtip-"+this.qtip.id)},f.prototype._setTarget=function(t,e){return f.__super__._setTarget.call(this,t,e),this.qtip.set("position.target",t||!1)},f.prototype._renderContent=function(t,e){var o=this,i=t.my||"left center",s=t.at||"right center";return this._adjustPlacement(i,s),this.qtip.set("content.text",e),this.qtip.set("position.container",t.container||a("body")),this.qtip.set("position.my",i),this.qtip.set("position.at",s),this.qtip.set("position.viewport",t.viewport||!1),this.qtip.set("position.target",t.target||!1),setTimeout(function(){return o._renderTipBackground(i.split(" ")[0])},10)},f.prototype._adjustPlacement=function(t,e){return 0===t.indexOf("top")?this._adjust(0,10):0===t.indexOf("bottom")?this._adjust(0,-10):0===t.indexOf("right")?this._adjust(-10,0):this._adjust(10,0)},f.prototype._adjust=function(t,e){return this.qtip.set("position.adjust.x",t),this.qtip.set("position.adjust.y",e)},f.prototype._renderTipBackground=function(t){var e=a("#qtip-"+this.qtip.id+" .qtip-tip"),o=e.find(".qtip-tip-bg");return o.length||(o=a("<div/>",{class:"icon icon-tip qtip-tip-bg"}),e.append(o)),o.removeClass("top left right bottom"),o.addClass(t)},f),Tourist.Tip.Simple=(s=Tourist.Tip.Base,t(d,s),d.prototype.initialize=function(t){return a("body").append(this.el)},d.prototype.show=function(){return this.el.show()},d.prototype.hide=function(){return this.el.hide()},d.prototype._getTipElement=function(){return this.el},d.prototype._renderContent=function(t,e){return this.el.html(e)},d),Tourist.Tour=(_.extend(y.prototype,Backbone.Events),y.prototype.start=function(){return this.trigger("start",this),this.next()},y.prototype.stop=function(t){return t?this._showCancelFinalStep():this._stop()},y.prototype.next=function(){var t=this._teardownCurrentStep(),e=0;return t&&(e=t.index+1),e<this.options.steps.length?this._showStep(this.options.steps[e],e):e===this.options.steps.length?this._showSuccessFinalStep():this._stop()},y.prototype.setStepOptions=function(t){return this.options.stepOptions=t},y.prototype.onChangeCurrentStep=function(t,e){return this.view.render(e)},y.prototype._showCancelFinalStep=function(){return this._showFinalStep(!1)},y.prototype._showSuccessFinalStep=function(){return this._showFinalStep(!0)},y.prototype._teardownCurrentStep=function(){var t=this.model.get("current_step");return this._teardownStep(t),t},y.prototype._stop=function(){return this._teardownCurrentStep(),this.model.set({current_step:null}),this.trigger("stop",this)},y.prototype._showFinalStep=function(t){var e=this._teardownCurrentStep(),o=t?this.options.successStep:this.options.cancelStep;return _.isFunction(o)&&(o.call(this,this,this.options.stepOptions),o=null),!o||e&&e.final?this._stop():(o.final=!0,this._showStep(o,this.options.steps.length))},y.prototype._showStep=function(t,e){if(t)return(t=_.clone(t)).index=e,t.total=this.options.steps.length,t.final||(t.final=this.options.steps.length===e+1&&!this.options.successStep),t=_.extend(t,this._setupStep(t)),this.model.set({current_step:t})},y.prototype._setupStep=function(t){var e,o,i,s;if(!t||!t.setup)return{};if(t.bind)for(o=0,i=(s=t.bind).length;o<i;o++)t[e=s[o]]=_.bind(t[e],t,this,this.options.stepOptions);return t.setup.call(t,this,this.options.stepOptions)||{}},y.prototype._teardownStep=function(t){return t&&t.teardown&&t.teardown.call(t,this,this.options.stepOptions),this.view.cleanupCurrentTarget()},y)}).call(this,jQuery);